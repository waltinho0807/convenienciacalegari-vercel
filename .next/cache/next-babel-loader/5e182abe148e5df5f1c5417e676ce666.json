{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\Documents\\\\convenienciacalegari-vercel\\\\pages\\\\cart.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport { parseCookies } from 'nookies';\nimport axios from 'axios';\nimport cookie from 'js-cookie';\nimport { Segment, Divider, Form, Button, Input, Checkbox } from 'semantic-ui-react';\nimport CartItemList from \"../components/Cart/CartItemList\";\nimport baseUrl from '../utils/baseUrl';\nimport catchErrors from '../utils/catchErrors';\nimport calculateCartTotal from '../utils/calculateCartTotal';\nconst INITIAL_ORDER = {\n  phone: \"\",\n  forma: \"\",\n  troco: \"\",\n  address: \"\",\n  bairro: \"\",\n  numero: \"\"\n};\nconst options = [{\n  key: 'cartao',\n  text: 'CARTÃO',\n  value: 'cartao'\n}, {\n  key: 'dinheiro',\n  text: 'DINHEIRO',\n  value: 'dinheiro'\n}];\n\nconst Cart = ({\n  products,\n  user\n}) => {\n  console.log(products);\n  const [cartProducts, setCartProducts] = React.useState(products);\n  const [success, setSuccess] = React.useState(false);\n  const [loading, setLoading] = React.useState(false);\n  const [cartAmout, setCartAmaount] = React.useState(0);\n  const [order, setOrder] = React.useState(INITIAL_ORDER);\n  const [isCartEmpty, setCartEmpty] = React.useState(false);\n  React.useEffect(() => {\n    const {\n      cartTotal\n    } = calculateCartTotal(products);\n    setCartAmaount(cartTotal);\n    setCartEmpty(products.length === 0);\n  }, [products]);\n\n  const handleChanhe = e => {\n    // console.log(d.value)\n    const {\n      name,\n      value\n    } = e.target;\n\n    if (name === 'media') {\n      setOrder(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n        media: files[0]\n      }));\n      setMediaPreview(window.URL.createObjectURL(files[0]));\n    } else {\n      setOrder(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n        [name]: value\n      }));\n    } //console.log(order);\n\n  };\n\n  const handleSelectInput = (e, d) => {\n    setOrder(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n      forma: d.value\n    }));\n  };\n\n  const handleRemoveFromCart = async productId => {\n    const url = `${baseUrl}/api/cart`;\n    const token = cookie.get(\"token\");\n    const payload = {\n      params: {\n        productId\n      },\n      headers: {\n        Authorization: token\n      }\n    };\n    const response = await axios.delete(url, payload);\n    setCartProducts(response.data);\n  };\n\n  const handleCheckout = async e => {\n    e.preventDefault();\n\n    try {\n      setLoading(true);\n      const url = `${baseUrl}/api/checkout`;\n      const token = cookie.get(\"token\");\n      const {\n        phone,\n        forma,\n        troco,\n        address,\n        numero,\n        bairro\n      } = order;\n      const payload = {\n        phone,\n        forma,\n        troco,\n        address,\n        numero,\n        bairro\n      };\n      const headers = {\n        headers: {\n          Authorization: token\n        }\n      };\n      await axios.post(url, payload, headers);\n      setOrder(INITIAL_ORDER);\n      setSuccess(true);\n    } catch (error) {\n      catchErrors(error, window.alert);\n      console.log(order);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return __jsx(\"div\", {\n    className: \"cart-area\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 9\n    }\n  }, __jsx(Segment, {\n    loading: loading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }\n  }, __jsx(CartItemList, {\n    handleRemoveFromCart: handleRemoveFromCart,\n    user: user,\n    products: cartProducts,\n    success: success,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 17\n    }\n  }), __jsx(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 17\n    }\n  }, __jsx(Divider, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 21\n    }\n  }), __jsx(Segment, {\n    clearing: true,\n    size: \"large\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 21\n    }\n  }, __jsx(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 25\n    }\n  }, \"Sub total:\"), \" R$\", cartAmout, __jsx(Form, {\n    success: success,\n    onSubmit: handleCheckout,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Input, {\n    fluid: true,\n    icon: \"phone\",\n    iconPosition: \"left\",\n    label: \"Telefone\",\n    placeholder: \"Tel\",\n    name: \"phone\",\n    type: \"text\",\n    value: order.phone,\n    onChange: handleChanhe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 29\n    }\n  }), __jsx(Form.Input, {\n    fluid: true,\n    icon: \"shipping\",\n    iconPosition: \"left\",\n    label: \"Rua\",\n    placeholder: \"Rua\",\n    name: \"address\",\n    type: \"text\",\n    value: order.address,\n    onChange: handleChanhe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 29\n    }\n  }), __jsx(Form.Group, {\n    widths: \"equal\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 29\n    }\n  }, __jsx(Form.Input, {\n    fluid: true,\n    icon: \"shipping\",\n    iconPosition: \"left\",\n    label: \"Bairro\",\n    placeholder: \"Bairro\",\n    name: \"bairro\",\n    type: \"text\",\n    value: order.bairro,\n    onChange: handleChanhe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 33\n    }\n  }), __jsx(Form.Input, {\n    fluid: true,\n    label: \"Numero\",\n    placeholder: \" N\\xBA\",\n    name: \"numero\",\n    type: \"number\",\n    value: order.numero,\n    onChange: handleChanhe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 33\n    }\n  })), __jsx(Form.Group, {\n    widths: \"equal\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 29\n    }\n  }, __jsx(Form.Select, {\n    name: \"forma\",\n    label: \"Forma de Pagamento\",\n    options: options,\n    placeholder: \"Como Pagar\",\n    onChange: handleSelectInput,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 33\n    }\n  }), __jsx(Form.Field, {\n    control: Input,\n    name: \"troco\",\n    label: \"* Troco para quanto?\",\n    placeholder: \"Somente se dinheiro\",\n    min: \"0.00\",\n    step: \"0.01\",\n    type: \"number\",\n    onChange: handleChanhe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 33\n    }\n  })), __jsx(Form.Field, {\n    control: Button,\n    type: \"submit\",\n    icon: \"cart\",\n    color: \"green\",\n    floated: \"right\",\n    content: \"Checkout\",\n    disabled: isCartEmpty || success,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 29\n    }\n  }))))));\n};\n\nCart.getInitialProps = async ctx => {\n  const {\n    token\n  } = parseCookies(ctx);\n\n  if (!token) {\n    return {\n      products: []\n    };\n  }\n\n  const url = `${baseUrl}/api/cart`;\n  const payload = {\n    headers: {\n      Authorization: token\n    }\n  };\n  const response = await axios.get(url, payload);\n  return {\n    products: response.data\n  };\n};\n\nexport default Cart;","map":{"version":3,"sources":["C:/Users/User/Documents/convenienciacalegari-vercel/pages/cart.js"],"names":["React","parseCookies","axios","cookie","Segment","Divider","Form","Button","Input","Checkbox","CartItemList","baseUrl","catchErrors","calculateCartTotal","INITIAL_ORDER","phone","forma","troco","address","bairro","numero","options","key","text","value","Cart","products","user","console","log","cartProducts","setCartProducts","useState","success","setSuccess","loading","setLoading","cartAmout","setCartAmaount","order","setOrder","isCartEmpty","setCartEmpty","useEffect","cartTotal","length","handleChanhe","e","name","target","prevState","media","files","setMediaPreview","window","URL","createObjectURL","handleSelectInput","d","handleRemoveFromCart","productId","url","token","get","payload","params","headers","Authorization","response","delete","data","handleCheckout","preventDefault","post","error","alert","getInitialProps","ctx"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { parseCookies } from 'nookies';\r\nimport axios from 'axios';\r\nimport cookie from 'js-cookie';\r\nimport { Segment, Divider, Form, Button, Input, Checkbox } from 'semantic-ui-react';\r\nimport CartItemList from \"../components/Cart/CartItemList\"\r\nimport baseUrl from '../utils/baseUrl';\r\nimport catchErrors from '../utils/catchErrors';\r\nimport calculateCartTotal from '../utils/calculateCartTotal';\r\n\r\nconst INITIAL_ORDER = {\r\n    phone: \"\",\r\n    forma: \"\",\r\n    troco: \"\",\r\n    address: \"\",\r\n    bairro: \"\",\r\n    numero: \"\"\r\n};\r\n\r\nconst options = [\r\n    { key: 'cartao', text: 'CARTÃO', value: 'cartao' },\r\n    { key: 'dinheiro', text: 'DINHEIRO', value: 'dinheiro' },\r\n\r\n]\r\n\r\nconst Cart = ({ products, user }) => {\r\n    console.log(products)\r\n    const [cartProducts, setCartProducts] = React.useState(products);\r\n    const [success, setSuccess] = React.useState(false);\r\n    const [loading, setLoading] = React.useState(false);\r\n\r\n    const [cartAmout, setCartAmaount] = React.useState(0);\r\n    const [order, setOrder] = React.useState(INITIAL_ORDER);\r\n    const [isCartEmpty, setCartEmpty] = React.useState(false);\r\n\r\n    React.useEffect(() => {\r\n        const { cartTotal } = calculateCartTotal(products);\r\n        setCartAmaount(cartTotal);\r\n        setCartEmpty(products.length === 0)\r\n    }, [products]);\r\n\r\n    const handleChanhe = e => {\r\n        // console.log(d.value)\r\n        const { name, value } = e.target;\r\n        if (name === 'media') {\r\n            setOrder(prevState => ({ ...prevState, media: files[0] }))\r\n            setMediaPreview(window.URL.createObjectURL(files[0]));\r\n        } else {\r\n            setOrder(prevState => ({ ...prevState, [name]: value }));\r\n        }\r\n        //console.log(order);\r\n    }\r\n    const handleSelectInput = (e, d) => {\r\n        setOrder(prevState => ({ ...prevState, forma: d.value }));\r\n    }\r\n\r\n    const handleRemoveFromCart = async (productId) => {\r\n        const url = `${baseUrl}/api/cart`;\r\n        const token = cookie.get(\"token\");\r\n        const payload = {\r\n            params: { productId },\r\n            headers: { Authorization: token }\r\n        };\r\n        const response = await axios.delete(url, payload);\r\n        setCartProducts(response.data);\r\n    }\r\n\r\n    const handleCheckout = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            setLoading(true);\r\n            const url = `${baseUrl}/api/checkout`;\r\n            const token = cookie.get(\"token\");\r\n            const { phone, forma, troco, address, numero, bairro } = order;\r\n            const payload = { phone, forma, troco, address, numero, bairro };\r\n            const headers = { headers: { Authorization: token } };\r\n            await axios.post(url, payload, headers);\r\n            setOrder(INITIAL_ORDER);\r\n            setSuccess(true);\r\n        } catch (error) {\r\n            catchErrors(error, window.alert);\r\n            console.log(order)\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"cart-area\">\r\n            <Segment loading={loading}>\r\n                <CartItemList\r\n                    handleRemoveFromCart={handleRemoveFromCart}\r\n                    user={user}\r\n                    products={cartProducts}\r\n                    success={success}\r\n                />\r\n                <React.Fragment>\r\n                    <Divider />\r\n                    <Segment clearing size=\"large\" >\r\n                        <strong>Sub total:</strong> R${cartAmout}\r\n                        <Form success={success} onSubmit={handleCheckout}>\r\n                            <Form.Input\r\n                                fluid\r\n                                icon=\"phone\"\r\n                                iconPosition=\"left\"\r\n                                label=\"Telefone\"\r\n                                placeholder=\"Tel\"\r\n                                name=\"phone\"\r\n                                type=\"text\"\r\n                                value={order.phone}\r\n                                onChange={handleChanhe}\r\n                            />\r\n\r\n                            <Form.Input\r\n                                fluid\r\n                                icon=\"shipping\"\r\n                                iconPosition=\"left\"\r\n                                label=\"Rua\"\r\n                                placeholder=\"Rua\"\r\n                                name=\"address\"\r\n                                type=\"text\"\r\n                                value={order.address}\r\n                                onChange={handleChanhe}\r\n                            />\r\n\r\n                            <Form.Group widths=\"equal\">\r\n                                <Form.Input\r\n                                    fluid\r\n                                    icon=\"shipping\"\r\n                                    iconPosition=\"left\"\r\n                                    label=\"Bairro\"\r\n                                    placeholder=\"Bairro\"\r\n                                    name=\"bairro\"\r\n                                    type=\"text\"\r\n                                    value={order.bairro}\r\n                                    onChange={handleChanhe}\r\n                                />\r\n                                <Form.Input\r\n                                    fluid\r\n                                    label=\"Numero\"\r\n                                    placeholder=\" Nº\"\r\n                                    name=\"numero\"\r\n                                    type=\"number\"\r\n                                    value={order.numero}\r\n                                    onChange={handleChanhe}\r\n                                />\r\n                            </Form.Group>\r\n\r\n\r\n\r\n                            <Form.Group widths=\"equal\">\r\n                                <Form.Select\r\n                                    name=\"forma\"\r\n                                    label='Forma de Pagamento'\r\n                                    options={options}\r\n                                    placeholder='Como Pagar'\r\n                                    onChange={handleSelectInput}\r\n                                />\r\n                                <Form.Field\r\n                                    control={Input}\r\n                                    name=\"troco\"\r\n                                    label=\"* Troco para quanto?\"\r\n                                    placeholder=\"Somente se dinheiro\"\r\n                                    min=\"0.00\"\r\n                                    step=\"0.01\"\r\n                                    type=\"number\"\r\n                                    onChange={handleChanhe}\r\n                                />\r\n                            </Form.Group>\r\n                            <Form.Field\r\n                                control={Button}\r\n                                type=\"submit\"\r\n                                icon=\"cart\"\r\n                                color=\"green\"\r\n                                floated=\"right\"\r\n                                content=\"Checkout\"\r\n                                disabled={isCartEmpty || success}\r\n                            />\r\n                        </Form>\r\n                    </Segment>\r\n\r\n                </React.Fragment>\r\n            </Segment>\r\n        </div>\r\n    );\r\n}\r\n\r\nCart.getInitialProps = async ctx => {\r\n    const { token } = parseCookies(ctx);\r\n    if (!token) {\r\n        return { products: [] };\r\n    }\r\n    const url = `${baseUrl}/api/cart`;\r\n    const payload = { headers: { Authorization: token } };\r\n    const response = await axios.get(url, payload);\r\n    return { products: response.data };\r\n}\r\n\r\nexport default Cart;"]},"metadata":{},"sourceType":"module"}